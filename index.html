<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <title>Coffee Ratio Wheel</title>
  <style>
    :root{
      --bg:#fff;
      --text:#111;
      --muted:#666;
      --line:#e7e7e7;
      --card:#fafafa;
      --radius:22px;
      --itemH:44px;     /* wheel row height */
      --visible:5;      /* must be odd (3,5,7...) */
      --gap:14px;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:var(--bg);
      color:var(--text);
      padding:18px;
      max-width:640px;
      margin-inline:auto;
      -webkit-tap-highlight-color: transparent;
    }
    h2{ margin: 8px 0 14px; font-size: 22px; }

    .card{
      border:1px solid var(--line);
      border-radius: var(--radius);
      padding:16px;
      background: #fff;
    }

    .row{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--gap);
      align-items:start;
    }

    .label{
      font-size: 13px;
      color: var(--muted);
      margin: 6px 0 10px;
    }

    .wheelWrap{
      position: relative;
      border: 1px solid var(--line);
      border-radius: 18px;
      overflow:hidden;
      background: var(--card);
      height: calc(var(--itemH) * var(--visible));
      touch-action: pan-y;
    }

    /* center highlight */
    .wheelWrap::before{
      content:"";
      position:absolute;
      left:10px; right:10px;
      top: calc((var(--visible) / 2) * var(--itemH) - (var(--itemH) / 2));
      height: var(--itemH);
      border-radius: 14px;
      background: rgba(0,0,0,0.06);
      border: 1px solid rgba(0,0,0,0.05);
      z-index: 3;
      pointer-events:none;
    }

    /* fade top/bottom */
    .wheelWrap::after{
      content:"";
      position:absolute;
      inset:0;
      background: linear-gradient(to bottom,
        rgba(255,255,255,0.95) 0%,
        rgba(255,255,255,0.0) 25%,
        rgba(255,255,255,0.0) 75%,
        rgba(255,255,255,0.95) 100%);
      z-index:2;
      pointer-events:none;
    }

    .wheel{
      height: 100%;
      overflow-y: auto;
      scroll-snap-type: y mandatory;
      -webkit-overflow-scrolling: touch;
      padding: calc((var(--visible) / 2) * var(--itemH)) 10px;
      scrollbar-width: none;
    }
    .wheel::-webkit-scrollbar{ display:none; }

    .item{
      height: var(--itemH);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size: 26px;
      font-variant-numeric: tabular-nums;
      scroll-snap-align: center;
      user-select:none;
    }
    .unit{
      font-size: 14px;
      color: var(--muted);
      margin-top: 8px;
      text-align:center;
    }

    .controls{
      display:flex;
      gap:10px;
      margin-top:10px;
    }
    button{
      flex:1;
      padding:12px 12px;
      border-radius: 16px;
      border:1px solid var(--line);
      background:#fff;
      font-size: 15px;
    }
    button:active{ transform: scale(0.99); }

    .meta{
      margin-top: 14px;
      font-size: 16px;
    }
    .small{
      margin-top: 6px;
      color: var(--muted);
      font-size: 12px;
      line-height: 1.35;
    }

    .divider{
      height:1px;
      background: var(--line);
      margin: 14px 0;
    }

    /* ratio inputs */
    .ratioRow{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--gap);
      align-items:center;
    }
    .ratioBox{
      border:1px solid var(--line);
      border-radius: 16px;
      padding: 12px;
      background:#fff;
    }
    .ratioBox label{
      display:block;
      font-size: 12px;
      color: var(--muted);
      margin-bottom:8px;
    }
    .ratioBox input{
      width:100%;
      font-size: 18px;
      padding: 10px;
      border-radius: 14px;
      border:1px solid var(--line);
      text-align:center;
    }
  </style>
</head>
<body>
  <h2>Coffee / Water Wheel</h2>

  <div class="card">
    <div class="row">
      <div>
        <div class="label">Water</div>
        <div class="wheelWrap">
          <div id="waterWheel" class="wheel" aria-label="Water wheel"></div>
        </div>
        <div class="unit">ml (≈ g)</div>
        <div class="controls">
          <button id="waterMinus" type="button">−10</button>
          <button id="waterPlus" type="button">+10</button>
        </div>
      </div>

      <div>
        <div class="label">Coffee</div>
        <div class="wheelWrap">
          <div id="coffeeWheel" class="wheel" aria-label="Coffee wheel"></div>
        </div>
        <div class="unit">grams</div>
        <div class="controls">
          <button id="coffeeMinus" type="button">−0.1</button>
          <button id="coffeePlus" type="button">+0.1</button>
        </div>
      </div>
    </div>

    <div class="divider"></div>

    <div class="ratioRow">
      <div class="ratioBox">
        <label>Ratio coffee (g)</label>
        <input id="ratioCoffee" type="number" step="0.1" value="16">
      </div>
      <div class="ratioBox">
        <label>Ratio water (ml/g)</label>
        <input id="ratioWater" type="number" step="1" value="250">
      </div>
    </div>

    <div class="meta" id="ratioText"></div>
    <div class="small">
      Scroll the wheels like a slot machine. Default behavior: changing <b>Water</b> updates <b>Coffee</b>.
      If you scroll <b>Coffee</b>, it will update <b>Water</b>.
    </div>
  </div>

<script>
/**
 * Wheel picker: pure HTML/CSS/JS, scroll-snap to center.
 * We'll build lists, then "snap" to nearest item on scroll end.
 */

const cfg = {
  visible: 5,
  itemH: 44,
  water: { min: 50, max: 2000, step: 10, unit: "ml", start: 250 },
  coffee:{ min: 1.0, max: 150.0, step: 0.1, unit: "g",  start: 16.0 }
};

const $ = (id) => document.getElementById(id);
const waterWheel = $("waterWheel");
const coffeeWheel = $("coffeeWheel");
const ratioCoffee = $("ratioCoffee");
const ratioWater  = $("ratioWater");
const ratioText   = $("ratioText");

// ----- helpers
const num = (v) => {
  const x = Number(v);
  return Number.isFinite(x) ? x : 0;
};
const clamp = (x, a, b) => Math.min(b, Math.max(a, x));
const roundTo = (x, step) => Math.round(x / step) * step;
const fmtCoffee = (x) => (Math.round(x * 10) / 10).toFixed(1);

function buildValues(min, max, step){
  const vals = [];
  const nSteps = Math.floor((max - min) / step);
  for(let i=0;i<=nSteps;i++){
    vals.push(min + i * step);
  }
  // ensure max included if rounding error
  if(vals[vals.length-1] < max - step/2) vals.push(max);
  return vals;
}

function populateWheel(wheelEl, values, formatter){
  wheelEl.innerHTML = "";
  for(const v of values){
    const div = document.createElement("div");
    div.className = "item";
    div.dataset.value = String(v);
    div.textContent = formatter ? formatter(v) : String(v);
    wheelEl.appendChild(div);
  }
}

function getNearestValue(wheelEl, values){
  // with scroll padding, the center line corresponds to scrollTop where an item is centered.
  // For snap: find index by (scrollTop / itemH) rounded.
  const idx = Math.round(wheelEl.scrollTop / cfg.itemH);
  return values[clamp(idx, 0, values.length - 1)];
}

function scrollToValue(wheelEl, values, value){
  // find nearest index
  let bestIdx = 0;
  let bestDiff = Infinity;
  for(let i=0;i<values.length;i++){
    const d = Math.abs(values[i] - value);
    if(d < bestDiff){ bestDiff = d; bestIdx = i; }
  }
  wheelEl.scrollTo({ top: bestIdx * cfg.itemH, behavior: "smooth" });
}

function snapToNearest(wheelEl, values){
  const v = getNearestValue(wheelEl, values);
  // snap precisely
  const idx = values.findIndex(x => x === v);
  wheelEl.scrollTo({ top: idx * cfg.itemH, behavior: "smooth" });
  return v;
}

function updateRatioText(){
  const rc = num(ratioCoffee.value);
  const rw = num(ratioWater.value);
  ratioText.textContent = (rc>0 && rw>0) ? `Ratio ≈ 1:${(rw/rc).toFixed(1)} (water per coffee)` : "";
}

// ----- values
const waterValues  = buildValues(cfg.water.min,  cfg.water.max,  cfg.water.step);
const coffeeValues = buildValues(cfg.coffee.min, cfg.coffee.max, cfg.coffee.step);

populateWheel(waterWheel, waterValues, (v)=> String(Math.round(v)));
populateWheel(coffeeWheel, coffeeValues, (v)=> fmtCoffee(v));

// ----- state to prevent feedback loops
let lastTouched = "water"; // "water" or "coffee"
let scrollTimerW = null;
let scrollTimerC = null;

function computeCoffeeFromWater(w){
  const rc = num(ratioCoffee.value);
  const rw = num(ratioWater.value);
  if(rc<=0 || rw<=0) return cfg.coffee.start;
  const c = (rc / rw) * w;
  return clamp(roundTo(c, cfg.coffee.step), cfg.coffee.min, cfg.coffee.max);
}

function computeWaterFromCoffee(c){
  const rc = num(ratioCoffee.value);
  const rw = num(ratioWater.value);
  if(rc<=0 || rw<=0) return cfg.water.start;
  const w = (rw / rc) * c;
  return clamp(roundTo(w, cfg.water.step), cfg.water.min, cfg.water.max);
}

function onWaterSettled(){
  const w = snapToNearest(waterWheel, waterValues);
  const c = computeCoffeeFromWater(w);
  scrollToValue(coffeeWheel, coffeeValues, c);
  updateRatioText();
}

function onCoffeeSettled(){
  const c = snapToNearest(coffeeWheel, coffeeValues);
  const w = computeWaterFromCoffee(c);
  scrollToValue(waterWheel, waterValues, w);
  updateRatioText();
}

// scroll-end detection
waterWheel.addEventListener("scroll", () => {
  lastTouched = "water";
  if(scrollTimerW) clearTimeout(scrollTimerW);
  scrollTimerW = setTimeout(() => {
    if(lastTouched === "water") onWaterSettled();
  }, 90);
}, { passive:true });

coffeeWheel.addEventListener("scroll", () => {
  lastTouched = "coffee";
  if(scrollTimerC) clearTimeout(scrollTimerC);
  scrollTimerC = setTimeout(() => {
    if(lastTouched === "coffee") onCoffeeSettled();
  }, 90);
}, { passive:true });

// step buttons
$("waterMinus").addEventListener("click", () => {
  const w = getNearestValue(waterWheel, waterValues);
  scrollToValue(waterWheel, waterValues, clamp(w - cfg.water.step, cfg.water.min, cfg.water.max));
});
$("waterPlus").addEventListener("click", () => {
  const w = getNearestValue(waterWheel, waterValues);
  scrollToValue(waterWheel, waterValues, clamp(w + cfg.water.step, cfg.water.min, cfg.water.max));
});
$("coffeeMinus").addEventListener("click", () => {
  const c = getNearestValue(coffeeWheel, coffeeValues);
  scrollToValue(coffeeWheel, coffeeValues, clamp(roundTo(c - cfg.coffee.step, cfg.coffee.step), cfg.coffee.min, cfg.coffee.max));
});
$("coffeePlus").addEventListener("click", () => {
  const c = getNearestValue(coffeeWheel, coffeeValues);
  scrollToValue(coffeeWheel, coffeeValues, clamp(roundTo(c + cfg.coffee.step, cfg.coffee.step), cfg.coffee.min, cfg.coffee.max));
});

// ratio changes: re-calc from whichever wheel user touched last
function onRatioChanged(){
  if(lastTouched === "coffee"){
    onCoffeeSettled();
  } else {
    onWaterSettled();
  }
}
ratioCoffee.addEventListener("input", onRatioChanged);
ratioWater.addEventListener("input", onRatioChanged);

// initial position
function init(){
  scrollToValue(waterWheel, waterValues, cfg.water.start);
  scrollToValue(coffeeWheel, coffeeValues, cfg.coffee.start);
  updateRatioText();
}
init();
</script>
</body>
</html>
